# Retail Monitor

Система мониторинга цен и отзывов товаров на розничных площадках.

## Быстрый старт

### Требования

- Docker и Docker Compose
- Git

### Установка

1. Клонируйте репозиторий и перейдите в директорию:
```bash
cd retail_monitor
```

2. Создайте файл окружения:
```bash
cp .env.example .env
# Отредактируйте .env, установив секреты
```

3. Запустите сервисы:
```bash
make build
make up
```

4. Инициализируйте приложение:
```bash
make init
```

5. Откройте в браузере: http://localhost:8000
   - Логин: `admin`
   - Пароль: `admin`

## Команды

```bash
make up        # Запустить все сервисы
make down      # Остановить сервисы
make logs      # Просмотр логов
make shell     # Django shell
make bash      # Bash в контейнере web
make migrate   # Применить миграции
make test      # Запустить тесты
make clean     # Удалить контейнеры и данные
```

## Архитектура

```
┌─────────────┐  ┌─────────────┐  ┌─────────────┐
│     web     │  │   worker    │  │  scheduler  │
│   Django    │  │   Celery    │  │ Celery Beat │
│   :8000     │  │ +Playwright │  │             │
└──────┬──────┘  └──────┬──────┘  └──────┬──────┘
       │                │                │
       └────────────────┴────────────────┘
                        │
       ┌────────────────┴────────────────┐
       │                                 │
       ▼                                 ▼
┌─────────────┐                 ┌─────────────┐
│  PostgreSQL │                 │    Redis    │
│    :5432    │                 │    :6379    │
└─────────────┘                 └─────────────┘
```

## Структура проекта

```
retail_monitor/
├── docker/                 # Docker конфигурация
├── src/
│   ├── config/            # Django настройки
│   ├── apps/
│   │   ├── core/          # Базовые модели, dashboard
│   │   ├── products/      # Товары и листинги
│   │   ├── retailers/     # Ретейлеры и сессии
│   │   ├── scraping/      # Сбор данных, коннекторы
│   │   ├── analytics/     # LLM анализ (Фаза 3)
│   │   ├── alerts/        # Оповещения (Фаза 4)
│   │   └── reports/       # Отчёты (Фаза 3)
│   ├── static/            # Статические файлы
│   └── templates/         # Базовые шаблоны
├── data/
│   ├── raw_snapshots/     # Сырые данные
│   ├── exports/           # Экспортированные отчёты
│   └── imports/           # Файлы для импорта
├── scripts/               # Скрипты инициализации
├── tests/                 # Тесты
├── docker-compose.yml
├── requirements.txt
└── Makefile
```

## Фазы разработки

- [x] **Фаза 0**: Инфраструктура (Docker, Django, Celery)
- [x] **Фаза 1**: MVP — товары, листинги, сбор цен (Ozon)
- [x] **Фаза 2**: Отзывы, расписание, ВкусВилл
- [x] **Фаза 3**: LLM анализ, экспорт XLSX
- [x] **Фаза 4**: Алерты, Telegram, остальные ретейлеры
- [x] **Фаза 5**: Dashboard, тесты, hardening

## Поддерживаемые ретейлеры

| Ретейлер | Цены | Отзывы | Статус |
|----------|------|--------|--------|
| Ozon | + | + | Полная поддержка |
| ВкусВилл | + | + | Полная поддержка |
| Перекрёсток | + | + | Полная поддержка |
| Яндекс Лавка | + | + | Полная поддержка |

## Ключевые возможности

### Мониторинг цен
- Автоматический сбор цен по расписанию (ежемесячно)
- Отслеживание обычных, промо и карточных цен
- История изменений с визуализацией

### Анализ отзывов
- Сбор и хранение отзывов покупателей
- LLM-анализ с извлечением тем и тональности
- Сравнение с конкурентами

### Оповещения
- Telegram-уведомления о важных событиях
- Настраиваемые правила: рост/падение цены, негативные отзывы
- Cooldown для предотвращения спама

### Экспорт
- Выгрузка данных в Excel (XLSX)
- Фильтрация по периодам, товарам, ретейлерам

## Мониторинг

- `/health/` — проверка здоровья сервиса
- `/ready/` — проверка готовности (для K8s/Docker)

## Лицензия

Внутренний инструмент.
